name: DÃ©ploiement de Site Statique

on:
  push:
    branches: ["main"] # DÃ©clencher uniquement au push sur la branche 'main'

jobs:
  # Job 1 : PrÃ©paration et Upload de l'Artefact
  build:
    runs-on: ubuntu-latest
    
    # ğŸ”‘ Permissions (nÃ©cessaires pour le jeton de l'action)
    permissions:
      contents: read # Lecture des fichiers sources
      pages: write   # Ã‰criture de l'artefact de Pages
      id-token: write # NÃ©cessaire pour l'authentification OIDC du dÃ©ploiement
      
    steps:
      - name: ğŸ“¦ RÃ©cupÃ©rer le code
        uses: actions/checkout@v4
      
      # 1. Configurer l'environnement GitHub Pages
      - name: âš™ï¸ Configurer GitHub Pages
        uses: actions/configure-pages@v4
        
      # 2. TÃ©lÃ©charger l'Artefact de dÃ©ploiement
      # Nous utilisons la racine du dÃ©pÃ´t (./) comme rÃ©pertoire de publication, 
      # car il n'y a pas de sous-dossier "dist" ou "build".
      - name: â¬†ï¸ Uploader l'Artefact Statique
        uses: actions/upload-pages-artifact@v3
        with:
          path: './' # PUBLIER TOUT LE CONTENU DE LA RACINE DU DÃ‰PÃ”T

  # Job 2 : DÃ©ploiement de l'Artefact sur Pages
  deploy:
    environment:
      # L'environnement 'github-pages' est obligatoire
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }} # URL gÃ©nÃ©rÃ©e
      
    runs-on: ubuntu-latest
    needs: build # DÃ©pend de la rÃ©ussite du job 'build'
    
    # Les permissions sont hÃ©ritÃ©es du job 'build' mais doivent Ãªtre rÃ©pÃ©tÃ©es si ce job Ã©tait indÃ©pendant
    
    steps:
      # 3. DÃ©ployer sur Pages
      - name: ğŸš€ DÃ©ployer sur GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4